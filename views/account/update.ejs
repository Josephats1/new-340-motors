<%# Unit 5, Assignment 5, Task 4 %>

<% if (title) { %>
<h1><%= title %></h1>
<% } else { res.redirect('/') } %>

<%- messages() %>

<% if (errors) { %>
<ul class="message warning">
  <% errors.array().forEach(error => { %>
  <li><%= error.msg %></li>
  <%  }) %>
</ul>
<% } %>

 <form method="post" action="/account/update/">
   <label for="account_firstname">First Name</label>
   <input type="text" name="account_firstname" id="account_firstname" required value="<%= locals.account_firstname %>">
   <label for="account_lastname">Last Name</label>
   <input type="text" name="account_lastname" id="account_lastname" required value="<%= locals.account_lastname %>">
   <label for="account_email">Email</label>
   <input type="email" name="account_email" id="account_email" required value="<%= locals.account_email %>">
   <input type="submit" value="Update">
   <input type="hidden" name="account_id" value="<%= locals.account_id %>">
 </form>


 <h2>Update Password</h2>
 <form method="post" action="/account/password">
   <span>Passwords must be at least 12 characters and contain at least 1 number, 1 capital letter and 1 special character</span>
   <p class="red">*note your original password will be changed.</p>
   <label for="password">Password</label>
   <input type="password" name="account_password" id="password" pattern="^(?=.*\d)(?=.*[a-z])(?=.*[A-Z])(?=.*[^a-zA-Z0-9])(?!.*\s).{12,}$" required>
   <div><i>Passwords must be minimum of 12 characters and include 1 capital letter, 1 number and 1 special character.</i></div>
   <div id="pswdBtn">Show Password</div>
   <input type="hidden" name="account_id" value="<%= locals.account_id %>">
   <input type="submit" value="Change Password">
 </form>

<div class="profile-picture-section">
    <h3>Profile Picture</h3>
    
    <div class="current-picture">
        <% if (locals.accountData && locals.accountData.account_profile_image) { %>
            <img src="/uploads/<%= locals.accountData.account_profile_image %>" 
                 alt="Profile Picture" 
                 class="profile-image">
            <p>Current profile picture</p>
        <% } else { %>
            <div class="no-image">
                <i class="fas fa-user-circle fa-5x"></i>
                <p>No profile picture uploaded yet.</p>
            </div>
        <% } %>
    </div>

    <!-- Camera Capture Modal -->
    <div id="cameraModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h4>Take a Photo</h4>
                <span class="close">&times;</span>
            </div>
            <div class="modal-body">
                <video id="video" autoplay playsinline></video>
                <canvas id="canvas" style="display: none;"></canvas>
                <div class="camera-controls">
                    <button id="captureBtn" class="btn btn-primary">
                        <i class="fas fa-camera"></i> Capture Photo
                    </button>
                    <button id="retakeBtn" class="btn btn-secondary" style="display: none;">
                        <i class="fas fa-redo"></i> Retake
                    </button>
                    <button id="usePhotoBtn" class="btn btn-success" style="display: none;">
                        <i class="fas fa-check"></i> Use This Photo
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Upload Options -->
    <div class="upload-options">
        <div class="option-card" onclick="openFilePicker()">
            <i class="fas fa-folder-open fa-3x"></i>
            <h4>Choose from Files</h4>
            <p>Select an image from your device</p>
        </div>
        
        <div class="option-card" onclick="openCamera()">
            <i class="fas fa-camera fa-3x"></i>
            <h4>Take Photo</h4>
            <p>Use your camera to take a new photo</p>
        </div>
    </div>

    <!-- Hidden File Input -->
    <form id="uploadForm" action="/account/upload" method="POST" enctype="multipart/form-data" class="upload-form">
        <input type="file" name="profile" id="profile" 
               accept="image/jpeg, image/jpg, image/png, image/gif" 
               class="form-control" style="display: none;">
        <input type="hidden" name="cameraImage" id="cameraImage">
    </form>

    <div class="form-info">
        <small class="form-text">Supported formats: JPG, JPEG, PNG, GIF. Max size: 2MB</small>
    </div>
</div>
<div class="profile-picture-section">
    <h3>Profile Picture</h3>
    
    <div class="current-picture">
        <% if (locals.accountData && locals.accountData.account_profile_image) { %>
            <img src="/uploads/<%= locals.accountData.account_profile_image %>" 
                 alt="Profile Picture" 
                 class="profile-image">
            <p>Current profile picture</p>
        <% } else { %>
            <div class="no-image">
                <i class="fas fa-user-circle fa-5x"></i>
                <p>No profile picture uploaded yet.</p>
            </div>
        <% } %>
    </divy: none;"> 
<script src="/js/script.js"></script>
